---
const API_URL =
  import.meta.env.PUBLIC_API_URL || "https://seoscribe.frank-couchman.workers.dev";
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
  />
  <title>AI Writer, Article Writer & Writing Tool | Long-Form SEO Content ‚Äì SEOScribe</title>

  <!-- Primary SEO -->
  <meta name="description" content="SEOScribe is the AI writer, article writer, and writing tool built for SEO. Create 2,000‚Äì6,000 word articles with citations, hero images, A/B titles, FAQs, and social posts. Free AI writer demo (1/day). The writing tool teams use to rank." />
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1" />
  <link rel="canonical" href="/" />

  <!-- Open Graph -->
  <meta property="og:title" content="AI Writer, Article Writer & Writing Tool ‚Äì SEOScribe" />
  <meta property="og:description" content="Generate long-form, citation-backed articles in minutes. Free AI writer demo (no signup) + SEO tools." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="/hero.png" />
  <meta property="og:url" content="/" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="SEOScribe ‚Äì AI Writer & Long-Form Article Writer" />
  <meta name="twitter:description" content="2‚Äì6k words, citations, hero image, FAQs, social posts. Free AI writer demo." />
  <meta name="twitter:image" content="/hero.png" />

  <!-- Keywords (legacy) -->
  <meta name="keywords" content="ai writer, article writer, writing tool, ai writing tool, blog writer, seo content writer, free article writer, ai blog generator, content brief, plagiarism checker, headline analyzer, readability, competitor analysis, meta description" />

  <!-- Favicon -->
  <link
    rel="icon"
    type="image/svg+xml"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ú®</text></svg>"
  />

  <!-- Performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
    rel="stylesheet"
  />
  <!-- Preload LCP hero image -->
  <link rel="preload" as="image" href="/hero.png" imagesrcset="/hero.png 1x" fetchpriority="high" />
  <link rel="preload" as="image" href="/1.jpeg" imagesrcset="/1.jpeg 1x" />

  <!-- Tailwind & Icons (kept for your current classes) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

  <style>
    /* Your base look & feel (unchanged) + a couple safe tweaks */
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
    body { background:linear-gradient(135deg,#0d183b 0%, #1f0f3f 50%, #0d183b 100%); min-height:100vh; color:#fff; }
    @keyframes fadeIn { from{opacity:0;transform:translateY(30px)} to{opacity:1;transform:translateY(0)} }
    @keyframes slideIn { from{opacity:0;transform:translateX(30px)} to{opacity:1;transform:translateX(0)} }
    @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-20px)} }
    @keyframes spin { to{transform:rotate(360deg)} }
    .animate-fade{animation:fadeIn .6s ease-out forwards}
    .animate-slide{animation:slideIn .5s ease-out forwards}
    .animate-float{animation:float 3s ease-in-out infinite}
    .animate-spin{animation:spin 1s linear infinite}
    .glass{background:rgba(255,255,255,.06); backdrop-filter:blur(20px); border:1px solid rgba(255,255,255,.12)}
    .glass-strong{background:rgba(255,255,255,.12); backdrop-filter:blur(30px); border:1px solid rgba(255,255,255,.2)}
    .gradient-text{background:linear-gradient(135deg,#7a5af8 0%,#d66efd 100%); -webkit-background-clip:text; -webkit-text-fill-color:transparent}
    .btn-primary{background:linear-gradient(135deg,#7a5af8 0%,#d66efd 100%); padding:1rem 1.2rem; border-radius:12px; font-weight:700; transition:.3s; border:none; cursor:pointer; box-shadow:0 10px 30px rgba(122,90,248,.3); color:#fff; display:inline-flex; align-items:center; gap:.5rem; text-decoration:none}
    .btn-primary:hover{transform:translateY(-2px); box-shadow:0 15px 40px rgba(214,110,253,.4)}
    .btn-primary:disabled{opacity:.6; cursor:not-allowed; transform:none}
    .btn-secondary{background:rgba(255,255,255,.05); padding:.8rem 1rem; border-radius:12px; font-weight:600; transition:.3s; border:1px solid rgba(255,255,255,.15); cursor:pointer; color:#fff; display:inline-flex; align-items:center; gap:.4rem}
    .btn-secondary:hover{background:rgba(255,255,255,.08); border-color:rgba(255,255,255,.25)}
    .btn-secondary:disabled{opacity:.5; cursor:not-allowed}
    .input-field{background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.1); padding:1.05rem 1.1rem; border-radius:12px; color:#fff; font-size:1rem; width:100%; transition:.3s}
    .input-field:focus{outline:none; border-color:#667eea; box-shadow:0 0 0 3px rgba(102,126,234,.1); background:rgba(255,255,255,.08)}
    .card{background:rgba(255,255,255,.07); backdrop-filter:blur(20px); border:1px solid rgba(255,255,255,.1); border-radius:16px; padding:1rem; transition:.3s}
    .badge{display:inline-flex; align-items:center; padding:.4rem .7rem; border-radius:999px; font-size:.8rem; font-weight:700}
    .pill{border:1px solid rgba(255,255,255,.18); border-radius:999px; padding:.35rem .7rem; display:inline-flex; gap:.4rem; align-items:center; margin:.25rem}
    .muted{color:rgba(255,255,255,.75)}
    .kicker{font-size:.8rem; letter-spacing:.08em; text-transform:uppercase; color:#a5b4fc; font-weight:800}
    .anchor{scroll-margin-top:100px}
    .table{width:100%; border-collapse:collapse}
    .table th,.table td{border:1px solid rgba(255,255,255,.12); padding:.65rem; text-align:left; font-size:.95rem}
    .table th{background:rgba(102,126,234,.08)}
    pre{white-space:pre-wrap; word-wrap:break-word}
    .glow-ring{position:absolute; inset:-2px; border-radius:20px; background:conic-gradient(from 180deg at 50% 50%, rgba(122,90,248,.35), rgba(214,110,253,.35), rgba(122,90,248,.35)); filter:blur(24px); opacity:.6; z-index:-1}
    details.faq summary::-webkit-details-marker{display:none}
    details.faq summary{cursor:pointer}

    /* Simple utility for hidden sections before JS toggles */
    .hidden { display: none; }
  </style>
</head>

<body>
  <!-- Sticky nav -->
  <nav id="topNav" class="fixed top-0 left-0 right-0 z-50">
    <div class="max-w-[1280px] mx-auto px-6 py-4 flex justify-between items-center glass-strong">
      <a href="#" class="relative flex items-center gap-3" id="logoLink">
        <div class="w-12 h-12 rounded-xl relative overflow-hidden"
             style="background:linear-gradient(135deg,#667eea,#764ba2);display:flex;align-items:center;justify-content:center;box-shadow:0 5px 15px rgba(102,126,234,.3)">
          <span class="glow-ring"></span>
          <i data-lucide="sparkles" class="w-6 h-6"></i>
        </div>
        <div>
          <div class="text-2xl font-black tracking-tight">SEOScribe</div>
          <div class="text-xs font-extrabold text-indigo-400">AI Writer</div>
        </div>
      </a>

      <!-- Right side (SSR default = logged out; JS updates when authenticated) -->
      <div id="navRight" class="flex gap-4 items-center">
        <a href="#tools" class="text-white/70 hover:text-white font-semibold">Tools</a>
        <a href="#pricing" class="text-white/70 hover:text-white font-semibold">Pricing</a>
        <button data-action="open-auth" class="btn-primary text-sm px-4 py-2">Start Free</button>
      </div>
    </div>
  </nav>

  <!-- HERO / Landing (SEO-rich for ai writer / article writer / writing tool) -->
  <section class="pt-32 pb-20 relative overflow-hidden">
    <div class="animate-float absolute top-0 left-0 w-80 h-80 bg-[radial-gradient(circle,rgba(122,90,248,.25)_0%,transparent_70%)] rounded-full blur-3xl" style="transform:translate(-30%, -30%)"></div>

    <div class="max-w-[1200px] mx-auto px-6 z-10 relative grid md:grid-cols-2 gap-12 items-center">
      <div class="text-left">
        <div class="badge glass inline-flex gap-2 items-center px-4 py-2 mb-4" style="background:rgba(102,126,234,.15);border:1px solid rgba(102,126,234,.3)">
          <span>üéÅ Free AI Writer</span><span>‚Ä¢</span><span>No Credit Card</span>
        </div>
        <h1 class="animate-fade text-4xl md:text-6xl font-black leading-tight mb-4">
          The <span class="gradient-text">AI writer</span> serious teams use
          ‚Äî long-form <span class="gradient-text">article writer</span> &
          SEO-ready <span class="gradient-text">writing tool</span>
        </h1>
        <p class="animate-fade text-lg text-white/80 max-w-md mb-6">
          Generate 2,000‚Äì6,000-word articles with citations and a beautiful hero image,
          plus FAQs and nine social posts. Research + writing + imagery in one flow.
        </p>

        <div class="glass-strong max-w-md p-6 rounded-2xl shadow-2xl">
          <form id="heroForm" class="flex flex-col gap-3">
            <input id="heroTopic" class="input-field text-[1.05rem]" placeholder="Enter your topic (e.g., Best Project Management Tools 2026)" />
            <input id="heroUrl" class="input-field text-[1rem]" placeholder="Your website URL (optional, for internal links)" />
            <button id="heroBtn" type="submit" class="btn-primary justify-center py-4">
              <i data-lucide="zap" class="w-5 h-5"></i><span>Generate Free Article</span>
            </button>
            <p id="heroNote" class="text-white/60 text-sm text-center hidden">‚è±Ô∏è Creating your rank-ready content‚Ä¶</p>
          </form>
          <p class="text-white/60 mt-3 text-sm">
            Free plan: 1 article/day. Pro: 15/day, unlimited library & export, analytics.
          </p>
          <a href="#tools" class="btn-secondary mt-4 w-full justify-center">
            <i data-lucide="settings"></i><span>Explore SEO Tools</span>
          </a>
        </div>
      </div>

      <!-- Hero image -->
      <div class="hidden md:flex justify-end">
        <img
          src="/hero.png"
          alt="AI writer creating a long-form SEO article with citations in SEOScribe"
          class="w-full max-w-xl rounded-3xl shadow-2xl"
          style="aspect-ratio: 16/10; object-fit: cover"
          fetchpriority="high"
          decoding="async"
          loading="eager"
          onerror="this.src='1.jpeg'; this.removeAttribute('fetchpriority');"
        />
      </div>
    </div>
  </section>

  <!-- BENEFITS -->
  <section class="py-14 glass-strong">
    <div class="max-w-[1100px] mx-auto px-4">
      <p class="kicker mb-2">AI WRITER BENEFITS</p>
      <h2 class="text-3xl md:text-4xl font-black mb-3">
        Why choose an AI writer and article writer that‚Äôs built to rank
      </h2>
      <p class="muted mb-6">
        SEOScribe is an <strong>AI writer</strong>, <strong>article writer</strong>, and
        <strong>writing tool</strong> designed for search. We generate structured, citation-backed content that‚Äôs ready to publish.
      </p>

      <div class="grid md:grid-cols-3 gap-3">
        <!-- 7 feature cards (unchanged) -->
        {[
          ['file-text','Long-form depth','2‚Äì6k words with H2/H3 sections and skimmable paragraphs.'],
          ['link','Citations included','Outbound references that build trust and E-E-A-T.'],
          ['image','AI-generated images','Every article includes a hero image.'],
          ['binary','A/B headlines','Multiple headline options ready for testing.'],
          ['sparkles','Keyword ideas & FAQs','Built-in keyword coverage to capture intent.'],
          ['share-2','9 social posts','Platform-native drafts for fast distribution.'],
          ['gauge','SEO-first structure','Meta description, readability, topical coverage.'],
        ].map(([icon,t,d]) => (
          <div class="card p-4 relative">
            <span class="glow-ring"></span>
            <div class="w-10 h-10 rounded-lg flex items-center justify-center mb-2" style="background:linear-gradient(135deg,#667eea,#764ba2)">
              <i data-lucide={icon} class="w-5 h-5"></i>
            </div>
            <div class="font-extrabold mb-1">{t}</div>
            <div class="muted">{d}</div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- VISUAL STRIP -->
  <section class="py-10">
    <div class="max-w-[1100px] mx-auto px-4 grid md:grid-cols-2 gap-8 items-center">
      <div>
        <h2 class="text-3xl md:text-4xl font-black mb-2">
          Rank in search ‚Äî and surface in AI overviews
        </h2>
        <p class="muted">
          Our <strong>AI writing tool</strong> structures content for classic SEO and emerging AI surfaces with citations and topical depth.
        </p>
      </div>
      <div class="rounded-2xl overflow-hidden shadow-2xl">
        <img src="/2.jpeg" alt="AI writer results and Google rankings" class="w-full h-full object-cover" style="aspect-ratio: 16/10" decoding="async" loading="lazy" onerror="this.style.display='none'"/>
      </div>
    </div>
  </section>

  <!-- USE CASES -->
  <section class="py-14 glass-strong" id="intents">
    <div class="max-w-[1100px] mx-auto px-4">
      <p class="kicker mb-2">USE CASES</p>
      <h2 class="text-3xl md:text-4xl font-black mb-4">What teams create with our AI writer</h2>

      <div class="grid md:grid-cols-3 gap-4">
        <div class="card p-4">
          <div class="font-extrabold mb-1">SEO articles</div>
          <p class="text-white/80 text-sm">
            Use our long-form <em>article writer</em> to produce in-depth guides that cover primary, secondary, and long-tail keywords.
          </p>
        </div>
        <div class="card p-4">
          <div class="font-extrabold mb-1">Blog workflows</div>
          <p class="text-white/80 text-sm">
            From outline to draft to social threads, the <em>AI writer</em> keeps tone consistent while inserting citations and A/B titles.
          </p>
        </div>
        <div class="card p-4">
          <div class="font-extrabold mb-1">Content refresh</div>
          <p class="text-white/80 text-sm">
            Update legacy content with better headings, internal links, and meta‚Äîan SEO-first <em>writing tool</em>.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- READY TO RANK -->
  <section class="py-14">
    <div class="max-w-[1100px] mx-auto px-4 grid md:grid-cols-2 gap-8 items-center">
      <div class="rounded-2xl overflow-hidden shadow-2xl order-2 md:order-1">
        <img src="/3.jpeg" alt="Ready to rank articles created by an AI writer" class="w-full h-full object-cover" style="aspect-ratio: 16/10" decoding="async" loading="lazy" onerror="this.style.display='none'"/>
      </div>
      <div class="order-1 md:order-2">
        <h2 class="text-3xl md:text-4xl font-black mb-2">Ready-to-publish, ready-to-rank</h2>
        <p class="muted">Long-form structure, citations, meta data, and social distribution packaged for speed.</p>
        <div class="mt-4 flex gap-2 flex-wrap">
          <span class="pill">2‚Äì6k words</span>
          <span class="pill">Citations</span>
          <span class="pill">Hero image</span>
          <span class="pill">A/B titles</span>
          <span class="pill">FAQs</span>
          <span class="pill">9 social drafts</span>
        </div>
      </div>
    </div>
  </section>

  <!-- COMPARE -->
  <section class="py-14">
    <div class="max-w-[1100px] mx-auto px-4">
      <h2 class="text-3xl md:text-4xl font-black text-center mb-3">SEOScribe vs Other AI Writing Tools</h2>
      <p class="text-center muted max-w-[820px] mx-auto mb-4">
        We‚Äôre the <strong>AI writer</strong> built for rankings. Unlike generic <strong>writing tools</strong>, SEOScribe focuses on long-form drafts with citations, images, keyword ideas, FAQs, and social posts.
      </p>
      <div class="glass-strong p-3 rounded-xl overflow-auto">
        <table class="table">
          <thead><tr><th>Feature</th><th>SEOScribe</th><th>Jasper</th><th>Copy.ai</th><th>Writesonic</th><th>Grammarly</th></tr></thead>
          <tbody>
            <tr><td>Long-form (2‚Äì6k words)</td><td>‚úÖ Included</td><td>‚úÖ</td><td>Varies</td><td>‚úÖ</td><td>Varies</td></tr>
            <tr><td>Citation-friendly</td><td>‚úÖ Built-in</td><td>Varies</td><td>Varies</td><td>Varies</td><td>Varies</td></tr>
            <tr><td>Hero Image</td><td>‚úÖ Included</td><td>Varies</td><td>Varies</td><td>Varies</td><td>Varies</td></tr>
            <tr><td>A/B Headlines</td><td>‚úÖ Yes</td><td>Available</td><td>Available</td><td>Available</td><td>Available</td></tr>
            <tr><td>Social Drafts</td><td>‚úÖ Included</td><td>Available</td><td>Available</td><td>Available</td><td>Available</td></tr>
            <tr><td>Free Plan Usable</td><td>‚úÖ 1/day + demo</td><td>Trials</td><td>Tools</td><td>Trials</td><td>Free tier</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- TESTIMONIALS IMAGE -->
  <section class="py-12 glass-strong">
    <div class="max-w-[1100px] mx-auto px-4 grid md:grid-cols-2 gap-8 items-center">
      <div>
        <h2 class="text-3xl md:text-4xl font-black mb-2">Marketers love the results</h2>
        <p class="muted">Social proof and feedback that highlight faster publishing and traffic lifts.</p>
      </div>
      <div class="rounded-2xl overflow-hidden shadow-2xl">
        <img src="/4.jpeg" alt="Testimonials for our AI writing tool" class="w-full h-full object-cover" style="aspect-ratio: 16/10" decoding="async" loading="lazy" onerror="this.style.display='none'"/>
      </div>
    </div>
  </section>

  <!-- PRICING -->
  <section id="pricing" class="py-14">
    <div class="max-w-[1100px] mx-auto px-4">
      <div class="text-center mb-8">
        <h2 class="text-3xl md:text-4xl font-black mb-2">Start Free, Upgrade When You‚Äôre Ready</h2>
        <p class="muted">Try our free <strong>AI writer</strong>‚Äîno credit card. Pro unlocks 15 articles/day, unlimited library & export, and analytics.</p>
      </div>

      <div class="grid md:grid-cols-2 gap-6 max-w-[900px] mx-auto">
        <div class="card p-8">
          <div class="badge mb-4" style="background:rgba(16,185,129,.15);border:1px solid rgba(16,185,129,.3);color:#10b981">FREE FOREVER</div>
          <h3 class="text-xl font-extrabold mb-2">Free Article Writer</h3>
          <div class="text-5xl font-black mb-1">$0</div>
          <div class="text-white/60 mb-4">Perfect for trying out</div>
          <ul class="space-y-2 mb-5">
            <li class="flex gap-2 items-center"><i data-lucide="check" class="w-5 h-5 text-emerald-400"></i><span>1 article per day</span></li>
            <li class="flex gap-2 items-center"><i data-lucide="check" class="w-5 h-5 text-emerald-400"></i><span>2‚Äì6k words each</span></li>
            <li class="flex gap-2 items-center"><i data-lucide="check" class="w-5 h-5 text-emerald-400"></i><span>Citations & hero image</span></li>
            <li class="flex gap-2 items-center"><i data-lucide="check" class="w-5 h-5 text-emerald-400"></i><span>A/B headlines & FAQs</span></li>
            <li class="flex gap-2 items-center"><i data-lucide="check" class="w-5 h-5 text-emerald-400"></i><span>9 social posts</span></li>
          </ul>
          <button data-action="scroll-hero" class="btn-secondary w-full">Start Writing Free</button>
        </div>

        <div class="card p-8 border-2 border-indigo-400 relative shadow-[0_20px_60px_rgba(102,126,234,.3)]">
          <div class="absolute -top-3 left-1/2 -translate-x-1/2 px-4 py-1 rounded-full text-sm font-bold" style="background:linear-gradient(135deg,#667eea,#764ba2)">MOST POPULAR</div>
          <div class="badge mb-3 mt-2" style="background:rgba(102,126,234,.15);border:1px solid rgba(102,126,234,.3);color:#667eea">BEST VALUE</div>
          <h3 class="text-xl font-extrabold mb-2">Pro Article Writer</h3>
          <div class="text-5xl font-black mb-1"><span class="gradient-text">$24</span><span class="text-xl text-white/60">/month</span></div>
          <div class="text-white/70 mb-4">For serious teams</div>
          <ul class="space-y-2 mb-5">
            <li class="flex gap-2 items-center"><i data-lucide="zap" class="w-5 h-5 text-indigo-300"></i><span>15 articles per day</span></li>
            <li class="flex gap-2 items-center"><i data-lucide="zap" class="w-5 h-5 text-indigo-300"></i><span>Unlimited library & export</span></li>
            <li class="flex gap-2 items-center"><i data-lucide="zap" class="w-5 h-5 text-indigo-300"></i><span>Priority queue</span></li>
            <li class="flex gap-2 items-center"><i data-lucide="zap" class="w-5 h-5 text-indigo-300"></i><span>Analytics & rewrites</span></li>
          </ul>
          <button data-action="upgrade" class="btn-primary w-full">Upgrade to Pro ‚Üí</button>
          <div class="text-center text-white/60 text-sm mt-2">Cancel anytime</div>
        </div>
      </div>
    </div>
  </section>

  <!-- TOOLS (kept compact; same endpoints) -->
  <section id="tools" class="py-14">
    <div class="max-w-[1200px] mx-auto p-4 pb-12">
      <h2 class="text-3xl md:text-4xl font-black mb-2">SEO & Writing Tools</h2>
      <p class="text-white/70 max-w-[800px] mb-6">Free: 1 use per tool/day; Pro: 10 per tool/day. Built to support your <strong>AI writer</strong> workflow.</p>

      <div class="grid md:grid-cols-2 gap-4">
        <!-- Headline Analyzer -->
        <div class="glass p-4 rounded-xl">
          <h3 class="font-extrabold mb-1">Headline Analyzer</h3>
          <input id="headlineInput" class="input-field mb-2" placeholder="Enter headline..." />
          <button id="headlineBtn" class="btn-primary mb-2">Analyze</button>
          <div id="headlineOut" class="muted text-sm"></div>
        </div>

        <!-- Readability -->
        <div class="glass p-4 rounded-xl">
          <h3 class="font-extrabold mb-1">Readability</h3>
          <textarea id="readabilityInput" class="input-field mb-2" rows="4" placeholder="Paste text..."></textarea>
          <button id="readabilityBtn" class="btn-primary mb-2">Check</button>
          <div id="readabilityOut" class="muted text-sm"></div>
        </div>

        <!-- SERP Preview -->
        <div class="glass p-4 rounded-xl">
          <h3 class="font-extrabold mb-1">SERP Preview</h3>
          <input id="serpTitle" class="input-field mb-2" placeholder="Title" />
          <input id="serpDesc" class="input-field mb-2" placeholder="Description" />
          <input id="serpUrl" class="input-field mb-2" placeholder="URL" />
          <button id="serpBtn" class="btn-primary mb-2">Preview</button>
          <div id="serpOut" class="muted text-sm"></div>
        </div>

        <!-- Plagiarism Checker -->
        <div class="glass p-4 rounded-xl">
          <h3 class="font-extrabold mb-1">Plagiarism Checker</h3>
          <textarea id="plagiarismInput" class="input-field mb-2" rows="4" placeholder="Paste text..."></textarea>
          <button id="plagiarismBtn" class="btn-primary mb-2">Check</button>
          <div id="plagiarismOut" class="muted text-sm"></div>
        </div>

        <!-- Competitor Analysis -->
        <div class="glass p-4 rounded-xl">
          <h3 class="font-extrabold mb-1">Competitor Analysis</h3>
          <input id="competitorKeyword" class="input-field mb-2" placeholder="Keyword (e.g., project management)" />
          <button id="competitorsBtn" class="btn-primary mb-2">Analyze</button>
          <div id="competitorsOut" class="muted text-sm"></div>
        </div>

        <!-- Keyword Cluster -->
        <div class="glass p-4 rounded-xl">
          <h3 class="font-extrabold mb-1">Keyword Cluster</h3>
          <input id="keywordsTopic" class="input-field mb-2" placeholder="Topic (e.g., productivity tools)" />
          <textarea id="keywordsText" class="input-field mb-2" rows="3" placeholder="Optional context..."></textarea>
          <button id="keywordsBtn" class="btn-primary mb-2">Cluster</button>
          <div id="keywordsOut" class="muted text-sm"></div>
        </div>

        <!-- Content Brief -->
        <div class="glass p-4 rounded-xl">
          <h3 class="font-extrabold mb-1">Content Brief</h3>
          <input id="briefKeyword" class="input-field mb-2" placeholder="Keyword" />
          <button id="briefBtn" class="btn-primary mb-2">Generate Brief</button>
          <div id="briefOut" class="muted text-sm"></div>
        </div>

        <!-- Meta Description -->
        <div class="glass p-4 rounded-xl">
          <h3 class="font-extrabold mb-1">Meta Description</h3>
          <textarea id="metaContent" class="input-field mb-2" rows="3" placeholder="Paste content here..."></textarea>
          <button id="metaBtn" class="btn-primary mb-2">Generate Meta</button>
          <div id="metaOut" class="muted text-sm"></div>
        </div>

        <!-- AI Assistant -->
        <div class="glass p-4 rounded-xl md:col-span-2">
          <h3 class="font-extrabold mb-1">AI Assistant</h3>
          <input id="assistantPrompt" class="input-field mb-2" placeholder="What would you like help with?" />
          <textarea id="assistantContext" class="input-field mb-2" rows="3" placeholder="Optional context (e.g., paste article section)"></textarea>
          <button id="assistantBtn" class="btn-primary mb-2">Get Suggestions</button>
          <div id="assistantOut" class="muted text-sm"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- ARTICLE VIEW (hidden until generation) -->
  <section id="articleWrap" class="py-10 hidden">
    <div class="max-w-[1000px] mx-auto px-4">
      <div class="flex justify-between items-center gap-2 flex-wrap mb-3">
        <button id="backBtn" class="btn-secondary"><i data-lucide="arrow-left"></i><span>Back</span></button>
        <div class="flex gap-2 flex-wrap">
          <button id="copyBtn" class="btn-secondary"><i data-lucide="copy"></i>Copy</button>
          <button id="exportBtn" class="btn-secondary"><i data-lucide="download"></i>Export</button>
          <button id="saveBtn" class="btn-primary">Save</button>
        </div>
      </div>

      <div class="glass-strong rounded-2xl p-6 md:p-8">
        <div id="aHero"></div>
        <div class="mb-4">
          <div class="kicker mb-1">A/B Headlines</div>
          <div id="aAlt" class="flex flex-wrap gap-2"></div>
          <h1 id="aTitle" class="text-3xl md:text-4xl font-black mt-3"></h1>
          <p id="aDesc" class="text-white/80 mt-2"></p>
          <div class="flex gap-2 mt-3 flex-wrap">
            <span id="aWords" class="pill"></span>
            <span id="aRead" class="pill"></span>
            <span id="aCiteCount" class="pill"></span>
          </div>
        </div>

        <div class="mt-4">
          <div class="kicker mb-2">Suggested Keywords</div>
          <div id="aKeywords" class="flex flex-wrap"></div>
        </div>

        <div id="aSections" class="mt-4"></div>

        <div id="aFaqs" class="mt-8 pt-4 border-t border-white/10"></div>
        <div id="aCitations" class="mt-8 pt-4 border-t border-white/10"></div>
        <div id="aLinks" class="mt-8 pt-4 border-t border-white/10"></div>
        <div id="aSocial" class="mt-8 pt-4 border-t border-white/10"></div>

        <!-- Sticky CTA (shown after demo if not signed in) -->
        <div id="stickyCta" class="hidden fixed bottom-4 right-4 left-4 md:left-auto z-[60]">
          <div class="glass-strong rounded-2xl p-4 md:min-w-[420px] shadow-2xl flex items-center gap-3">
            <i data-lucide="bookmark-plus" class="w-6 h-6"></i>
            <div class="flex-1 text-sm">Create a free account to <strong>save</strong> and <strong>export</strong>. You get <strong>1/day free</strong>.</div>
            <button data-action="open-auth" class="btn-primary py-2">Sign Up</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- FAQ -->
  <section id="faq" class="py-16 glass-strong">
    <div class="max-w-[1100px] mx-auto px-4">
      <h2 class="text-3xl md:text-4xl font-black mb-6">FAQ: AI Writer, Article Writer & Writing Tool</h2>
      <div class="space-y-3">
        {[
          ['Is SEOScribe really a free AI writer?', 'Yes. You can generate one full article per day (2‚Äì6k words) without signing in. Pro unlocks 15/day, library, export, and analytics.'],
          ['What makes this AI writing tool better for SEO?', 'We generate long-form drafts with citations, clean H2/H3 structure, meta data, hero images, A/B titles, keyword ideas, FAQs and social posts.'],
          ['Can the article writer handle long-form content?', 'Yes. Our writer targets 2‚Äì6k words with readable sections and optional internal link suggestions.'],
          ['Will my content rank on Google?', 'We structure for SEO with depth, keywords, citations, hero images and FAQs. Ranking also depends on your domain, links and competition.'],
          ['Do you include tools beyond the AI writer?', 'Yes‚Äîheadline analyzer, readability, SERP preview, plagiarism estimation, keyword clustering, content briefs and more.'],
        ].map(([q,a]) => (
          <details class="faq glass p-4 rounded-xl">
            <summary class="flex items-center justify-between font-extrabold cursor-pointer">
              <span>{q}</span>
              <i data-lucide="chevron-down" class="w-5 h-5"></i>
            </summary>
            <div class="text-white/80 mt-2">{a}</div>
          </details>
        ))}
      </div>
    </div>
  </section>

  <!-- CTA FOOTER -->
  <section class="py-16 glass-strong">
    <div class="max-w-[1100px] mx-auto px-4 text-center">
      <h2 class="text-3xl md:text-4xl font-black mb-4">Ready to dominate your niche?</h2>
      <p class="text-white/70 mb-6">Create long-form articles with SEO power, hero images and internal links. Start free or upgrade to Pro to unlock everything.</p>
      <button class="btn-primary text-lg px-6 py-4" data-action="open-auth">Start Free Today</button>
    </div>
  </section>

  <footer class="py-8 glass-strong">
    <div class="max-w-[1100px] mx-auto px-4 flex flex-col md:flex-row justify-between items-center">
      <div class="text-white/70 mb-3 md:mb-0">¬© 2025 SEOScribe. All rights reserved.</div>
      <div class="flex gap-4">
        <a href="#" data-action="open-privacy" class="text-white/70 hover:text-white underline">Privacy</a>
        <a href="#" data-action="open-terms" class="text-white/70 hover:text-white underline">Terms</a>
      </div>
    </div>
  </footer>

  <!-- AUTH / PRIVACY / TERMS MODALS -->
  <div id="authModal" style="display:none;position:fixed;inset:0;z-index:9999">
    <div style="position:fixed;inset:0;background:rgba(0,0,0,.8);backdrop-filter:blur(10px)" data-action="close-auth"></div>
    <div style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:90%;max-width:520px">
      <div class="glass-strong p-6 md:p-8 rounded-2xl relative">
        <button data-action="close-auth" class="absolute top-2 right-2 text-white/70"><i data-lucide="x"></i></button>
        <div class="text-center mb-4">
          <div class="w-16 h-16 rounded-xl mx-auto mb-3 flex items-center justify-center" style="background:linear-gradient(135deg,#667eea,#764ba2)">
            <i data-lucide="sparkles" class="w-7 h-7"></i>
          </div>
          <h2 class="text-xl font-black">Create Your Library</h2>
          <p class="text-white/70">Save and manage your articles</p>
        </div>
        <button data-action="google-auth" class="btn-primary w-full justify-center mb-3">
          <svg style="width:20px;height:20px" viewBox="0 0 24 24"><path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="currentColor" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="currentColor" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="currentColor" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
          <span>Continue with Google</span>
        </button>
        <div class="text-center text-white/60 my-2 text-sm">or</div>
        <form id="magicForm" class="flex flex-col gap-2">
          <input type="email" id="authEmail" placeholder="your@email.com" class="input-field" required />
          <button type="submit" class="btn-secondary w-full">Send Magic Link ‚Üí</button>
          <p class="text-center text-white/60 text-xs">We‚Äôll email a secure sign-in link</p>
        </form>
      </div>
    </div>
  </div>

  <div id="privacyModal" style="display:none;position:fixed;inset:0;z-index:9999">
    <div style="position:fixed;inset:0;background:rgba(0,0,0,.8);backdrop-filter:blur(10px)" data-action="close-privacy"></div>
    <div style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:90%;max-width:600px">
      <div class="glass-strong p-6 md:p-8 rounded-2xl relative" style="max-height:80vh;overflow-y:auto;">
        <button data-action="close-privacy" class="absolute top-2 right-2 text-white/70"><i data-lucide="x"></i></button>
        <h2 class="text-2xl font-black mb-3">Privacy Policy</h2>
        <div class="text-white/70 text-sm space-y-3">
          <p>We collect only the data necessary to provide our services, including your email and usage statistics. We never sell your data.</p>
          <p>Your articles and usage data are stored securely to enable features like library and analytics. You may request deletion at any time.</p>
        </div>
      </div>
    </div>
  </div>

  <div id="termsModal" style="display:none;position:fixed;inset:0;z-index:9999">
    <div style="position:fixed;inset:0;background:rgba(0,0,0,.8);backdrop-filter:blur(10px)" data-action="close-terms"></div>
    <div style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:90%;max-width:600px">
      <div class="glass-strong p-6 md:p-8 rounded-2xl relative" style="max-height:80vh;overflow-y:auto;">
        <button data-action="close-terms" class="absolute top-2 right-2 text-white/70"><i data-lucide="x"></i></button>
        <h2 class="text-2xl font-black mb-3">Terms of Service</h2>
        <div class="text-white/70 text-sm space-y-3">
          <p>You may use our AI tools to generate content for personal or commercial use. Review generated content before publication.</p>
          <p>We may update terms at any time. Continued use constitutes acceptance.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- JSON-LD (unchanged, with keywords aligned to ai writer / article writer / writing tool) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "SEOScribe - AI Writer & Article Writer",
    "applicationCategory": "BusinessApplication",
    "applicationSubCategory": "ContentCreationSoftware",
    "operatingSystem": "Web",
    "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" },
    "aggregateRating": { "@type": "AggregateRating", "ratingValue": "4.9", "ratingCount": "12847" },
    "description": "Free AI writer and writing tool that generates 2,000‚Äì6,000 word SEO articles with citations and hero images.",
    "keywords": "ai writer, article writer, ai writing tool, writing tool, free article writer",
    "url": "https://seoscribe.example/"
  }
  </script>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebSite",
    "name":"SEOScribe",
    "url":"https://seoscribe.example/",
    "potentialAction":{
      "@type":"SearchAction",
      "target":"https://seoscribe.example/?q={search_term_string}",
      "query-input":"required name=search_term_string"
    }
  }
  </script>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      { "@type":"Question","name":"Is SEOScribe really a free AI writer?","acceptedAnswer":{"@type":"Answer","text":"Yes. You can generate one full article per day (2‚Äì6k words each) without signing in. Pro unlocks 15/day along with library, export, and analytics."}},
      { "@type":"Question","name":"What makes this AI writing tool better for SEO?","acceptedAnswer":{"@type":"Answer","text":"We generate long-form content with citations, H2/H3 structure, hero images, A/B headlines, keyword ideas, FAQs, and social posts."}},
      { "@type":"Question","name":"Can the article writer handle long-form content?","acceptedAnswer":{"@type":"Answer","text":"Yes. Our writer targets 2‚Äì6k words with readable sections and optional internal link suggestions."}},
      { "@type":"Question","name":"Will my content rank on Google?","acceptedAnswer":{"@type":"Answer","text":"We structure for SEO and provide depth, keywords, citations, hero images and FAQs. Ranking also depends on your domain, links, and competition."}},
      { "@type":"Question","name":"Do you include tools beyond the AI writer?","acceptedAnswer":{"@type":"Answer","text":"Yes‚Äîour tools include headline analyzer, readability, SERP preview, plagiarism estimation, keyword clustering and content briefs."}}
    ]
  }
  </script>

  <!-- Make API URL available -->
  <script>window.SEOSCRIBE_API_URL = ${JSON.stringify(API_URL)};</script>

  <!-- Minimal, defensive JS: calls your Worker API, renders results into SSR DOM, and never blocks the first paint -->
  <script>
  (function(){
    const API = window.SEOSCRIBE_API_URL || "https://seoscribe.frank-couchman.workers.dev";

    const $ = (s) => document.querySelector(s);
    const esc = (s) => String(s||"").replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));

    // AUTH STATE (kept lightweight; only what we need client-side)
    const state = {
      authToken: localStorage.getItem('authToken') || null,
      userEmail: null,
      plan: 'free',
      article: null,
      chosenTitle: null,
      ctaShown: false
    };
    const authHeaders = () => {
      const h = {'Content-Type':'application/json'};
      if(state.authToken) h['Authorization'] = 'Bearer ' + state.authToken;
      return h;
    };

    // NAV update if logged in
    function setNavLoggedIn(email, plan){
      const wrap = $('#navRight');
      if(!wrap) return;
      wrap.innerHTML = `
        <a href="#tools" class="text-white/70 hover:text-white font-semibold">Tools</a>
        <span class="text-sm text-white/70 font-semibold">${esc(email)} ‚Ä¢ <span class="text-indigo-300 font-extrabold uppercase">${esc(plan||'free')}</span></span>
        <button id="billingBtn" class="btn-secondary text-sm px-3 py-2">Billing</button>
        <button id="signoutBtn" class="btn-secondary text-sm px-3 py-2">Sign out</button>
      `;
      $('#billingBtn')?.addEventListener('click', openBillingPortal);
      $('#signoutBtn')?.addEventListener('click', () => { localStorage.removeItem('authToken'); localStorage.removeItem('refreshToken'); location.reload(); });
    }

    async function fetchProfile(){
      try{
        const r = await fetch(API + '/api/profile', { headers: authHeaders(), mode: 'cors' });
        if(!r.ok) return;
        const d = await r.json();
        state.userEmail = d.email || null;
        state.plan = d.plan || 'free';
        if(state.userEmail) setNavLoggedIn(state.userEmail, state.plan);
      }catch{}
    }
    if(state.authToken) fetchProfile();

    // Forms and buttons
    const heroForm = $('#heroForm');
    const heroBtn = $('#heroBtn');
    const heroNote = $('#heroNote');
    const backBtn = $('#backBtn');
    const saveBtn = $('#saveBtn');
    const copyBtn = $('#copyBtn');
    const exportBtn = $('#exportBtn');

    // ARTICLE RENDER
    const aHero = $('#aHero'), aAlt = $('#aAlt'), aTitle = $('#aTitle'), aDesc = $('#aDesc');
    const aWords = $('#aWords'), aRead = $('#aRead'), aCiteCount = $('#aCiteCount');
    const aKeywords = $('#aKeywords'), aSections = $('#aSections'), aFaqs = $('#aFaqs');
    const aCitations = $('#aCitations'), aLinks = $('#aLinks'), aSocial = $('#aSocial');

    function showArticle(){
      $('#articleWrap')?.classList.remove('hidden');
      window.scrollTo({ top: $('#articleWrap').offsetTop - 10, behavior: 'smooth' });
    }
    function hideArticle(){ $('#articleWrap')?.classList.add('hidden'); window.scrollTo({ top:0, behavior:'smooth' }); }

    function renderArticle(d){
      state.article = d || {};
      state.chosenTitle = d.title || null;

      // Hero image
      aHero.innerHTML = '';
      if(d.image){
        const src = d.image.image_url || (d.image.image_b64 ? "data:" + (d.image.media_type || "image/png") + ";base64," + d.image.image_b64 : "");
        if(src){
          const img = document.createElement('img');
          img.src = src; img.alt = "Article illustration created by the AI writer";
          img.style.width = "100%"; img.style.maxHeight = "420px"; img.style.objectFit = "cover"; img.style.borderRadius = "12px";
          aHero.appendChild(img);
        }
      }

      // A/B titles
      aAlt.innerHTML = '';
      const alts = [d.title, ...(d.alternative_titles || [])].filter(Boolean).slice(0,4);
      alts.forEach(t => {
        const b = document.createElement('button');
        b.className = 'pill';
        b.textContent = t;
        b.addEventListener('click', () => { state.chosenTitle = t; aTitle.textContent = t; });
        aAlt.appendChild(b);
      });

      aTitle.textContent = state.chosenTitle || d.title || 'Untitled';
      aDesc.textContent = d?.meta?.description || '';
      aWords.textContent = 'üìä ' + (d.word_count || 0) + ' words';
      aRead.textContent = '‚è±Ô∏è ' + (d.reading_time_minutes || 0) + ' min read';
      aCiteCount.textContent = 'üîó ' + ((d.citations || []).length) + ' sources';

      // Keywords
      const kws = (d.seo_keywords || d.keyword_suggestions || []).slice(0,30);
      aKeywords.innerHTML = kws.map(k => `<span class="pill">${esc(k)}</span>`).join('');

      // Sections
      aSections.innerHTML = (d.sections || []).map((s) => `
        <div class="mt-6">
          <h2 class="text-2xl font-extrabold text-indigo-200">${esc(s.heading || '')}</h2>
          ${(s.paragraphs || []).map(p => `<p class="muted mt-2 leading-7">${esc(p)}</p>`).join('')}
        </div>
      `).join('');

      // FAQs
      aFaqs.innerHTML = (d.faqs && d.faqs.length)
        ? `<h3 class="text-xl font-black mb-2">FAQs</h3>` + d.faqs.map(f => `
            <div class="mb-3"><div class="font-extrabold">${esc(f.q||'')}</div><div class="muted">${esc(f.a||'')}</div></div>
          `).join('')
        : '';

      // Citations
      aCitations.innerHTML = (d.citations && d.citations.length)
        ? `<h3 class="text-xl font-black mb-2">Sources & Citations</h3>` + d.citations.map((c,i) => `
            <div class="glass p-3 rounded-lg my-2 flex gap-2 items-start">
              <span class="text-indigo-300 font-black">[${i+1}]</span>
              <a class="text-indigo-200 hover:underline" href="${esc(c.url||'#')}" target="_blank" rel="noopener">${esc(c.title||('Source '+(i+1)))}</a>
            </div>
          `).join('')
        : '';

      // Internal links
      aLinks.innerHTML = (d.internal_links && d.internal_links.length)
        ? `<h3 class="text-xl font-black mb-2">Suggested Internal Links</h3>` + d.internal_links.map((l) => `
            <div class="glass p-3 rounded-lg my-2 flex gap-2 items-start">
              <a class="text-indigo-200 hover:underline" href="${esc(l.url||'#')}" target="_blank" rel="noopener">${esc(l.title||'Link')}</a>
              ${l.suggested_anchor ? `<span class="muted">‚Äî ${esc(l.suggested_anchor)}</span>`:''}
            </div>
          `).join('')
        : '';

      // Social
      const s = d.social_media_posts || {};
      const pairs = [
        ['Twitter/X Thread', s.twitter_threads || s.twitter || ''],
        ['LinkedIn Post', s.linkedin_post || s.linkedin || ''],
        ['Facebook Post', s.facebook || ''],
        ['Instagram Caption', s.instagram_caption || s.instagram || ''],
        ['Reddit Post', s.reddit || ''],
        ['TikTok Script', s.tiktok_script || s.tiktok || ''],
        ['Pinterest Pin', s.pinterest || ''],
        ['YouTube Description', s.youtube || ''],
        ['Tumblr Post', s.tumblr || ''],
      ];
      aSocial.innerHTML = `<h3 class="text-xl font-black mb-2">Social Drafts</h3>
        <div class="grid md:grid-cols-2 gap-3">
          ${pairs.map(([label,text]) => `
            <div class="card p-3">
              <div class="font-extrabold mb-1">${label}</div>
              <pre class="text-sm text-white/85">${esc(Array.isArray(text) ? text.join('\\n\\n') : (text || ''))}</pre>
            </div>
          `).join('')}
        </div>`;

      showArticle();
      try{ window.lucide && lucide.createIcons(); }catch{}
    }

    // GENERATION
    heroForm?.addEventListener('submit', async (e) => {
      e.preventDefault();
      const topic = $('#heroTopic')?.value.trim();
      const website_url = $('#heroUrl')?.value.trim();
      if(!topic){ alert('Please enter a topic'); return; }
      heroBtn.disabled = true; heroNote?.classList.remove('hidden');

      const body = { topic, tone: 'professional', target_word_count: (state.plan==='pro'?5500:3000), generate_social: true };
      if(website_url) body.website_url = website_url;
      try{
        const r = await fetch(API + '/api/draft', {
          method: 'POST', headers: authHeaders(), body: JSON.stringify(body), mode: 'cors'
        });
        const d = await (r.ok ? r.json() : r.json().catch(()=>({})));
        if(!r.ok){
          if(r.status===429) return alert(d.message || 'Daily limit reached.');
          if(r.status===403) return alert(d.message || 'Free demo used. Please sign in.');
          throw new Error(d.message || d.error || 'Generation failed');
        }
        renderArticle(d);
        if(!state.userEmail && !state.ctaShown){
          state.ctaShown = true;
          setTimeout(()=> $('#stickyCta')?.classList.remove('hidden'), 1200);
        }
      }catch(err){ alert(err?.message || 'Request failed'); }
      heroBtn.disabled = false; heroNote?.classList.add('hidden');
    });

    backBtn?.addEventListener('click', hideArticle);

    // SAVE / COPY / EXPORT
    saveBtn?.addEventListener('click', async () => {
      if(!state.authToken){ openAuth(); return; }
      if(!state.article) return;
      const body = {
        title: state.chosenTitle || state.article.title || 'Untitled',
        data: state.article,
        word_count: state.article.word_count || 0,
        reading_time_minutes: state.article.reading_time_minutes || 0
      };
      try{
        const r = await fetch(API + '/api/articles', { method: 'POST', headers: authHeaders(), body: JSON.stringify(body), mode: 'cors' });
        if(!r.ok) throw new Error('Save failed');
        alert('Saved to your library ‚úÖ');
      }catch(e){ alert(e?.message || 'Save failed'); }
    });

    function mdFromArticle(a){
      let md = '# ' + (state.chosenTitle || a.title || 'Untitled') + '\\n\\n';
      if(a.meta?.description) md += '> ' + a.meta.description + '\\n\\n';
      (a.sections || []).forEach(s => {
        md += '## ' + (s.heading || '') + '\\n\\n';
        (s.paragraphs || []).forEach(p => { md += p + '\\n\\n'; });
      });
      if((a.faqs || []).length){
        md += '\\n## FAQs\\n\\n';
        a.faqs.forEach(f => { md += '**' + (f.q||'') + '**\\n\\n' + (f.a||'') + '\\n\\n'; });
      }
      return md;
    }
    copyBtn?.addEventListener('click', async () => {
      if(!state.article) return;
      try{ await navigator.clipboard.writeText(mdFromArticle(state.article)); alert('Copied ‚úÖ'); }catch{ alert('Copy failed'); }
    });
    exportBtn?.addEventListener('click', () => {
      if(!state.article) return;
      const blob = new Blob([mdFromArticle(state.article)], { type: 'text/markdown' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'article.md'; a.click();
      URL.revokeObjectURL(url);
    });

    // TOOLS ‚Äî helper
    async function postTool(path, payload){
      const r = await fetch(API + path, { method:'POST', headers: authHeaders(), body: JSON.stringify(payload||{}), mode:'cors' });
      const d = await (r.ok ? r.json() : r.json().catch(()=>({})));
      if(!r.ok) throw new Error(d.error || d.message || 'Action failed');
      return d;
    }

    // Headline
    $('#headlineBtn')?.addEventListener('click', async () => {
      const headline = $('#headlineInput')?.value.trim();
      if(!headline) return alert('Enter a headline');
      const outEl = $('#headlineOut'); outEl.textContent = 'Analyzing‚Ä¶';
      try{
        const d = await postTool('/api/tools/headline-analyzer', { headline });
        outEl.innerHTML = `Score: <b>${d.score}</b> ‚Ä¢ Length: ${d.length} chars ‚Ä¢ Grade: ${d.grade}`;
      }catch(e){ outEl.textContent = e.message || 'Failed'; }
    });

    // Readability
    $('#readabilityBtn')?.addEventListener('click', async () => {
      const text = $('#readabilityInput')?.value.trim();
      if(!text) return alert('Paste text');
      const outEl = $('#readabilityOut'); outEl.textContent = 'Checking‚Ä¶';
      try{
        const d = await postTool('/api/tools/readability', { text });
        outEl.innerHTML = `FRE: <b>${d.flesch_reading_ease}</b> ‚Ä¢ FK Grade: ${d.flesch_kincaid_grade} ‚Ä¢ Level: ${d.level}`;
      }catch(e){ outEl.textContent = e.message || 'Failed'; }
    });

    // SERP
    $('#serpBtn')?.addEventListener('click', async () => {
      const title = $('#serpTitle')?.value.trim();
      const description = $('#serpDesc')?.value.trim();
      const url = $('#serpUrl')?.value.trim();
      const out = $('#serpOut'); out.textContent = 'Generating preview‚Ä¶';
      try{
        const d = await postTool('/api/tools/serp-preview', { title, description, url });
        const g = d.google || {};
        out.innerHTML = `
          <div class="glass p-3 rounded-lg">
            ${g.display_url ? `<div class="text-emerald-300 text-xs mb-1">${esc(g.display_url)}</div>`:''}
            ${g.title ? `<div class="text-lg font-bold mb-1">${esc(g.title)}</div>`:''}
            ${g.snippet ? `<div class="text-white/80 text-sm">${esc(g.snippet)}</div>`:''}
          </div>`;
      }catch(e){ out.textContent = e.message || 'Failed'; }
    });

    // Plagiarism
    $('#plagiarismBtn')?.addEventListener('click', async () => {
      const text = $('#plagiarismInput')?.value.trim();
      if(!text) return alert('Paste text');
      const out = $('#plagiarismOut'); out.textContent = 'Checking‚Ä¶';
      try{
        const d = await postTool('/api/tools/plagiarism', { text });
        out.innerHTML = `Originality: <b>${d.originality_score}%</b> (${esc(String(d.status||'').replace('_',' '))})`;
      }catch(e){ out.textContent = e.message || 'Failed'; }
    });

    // Competitors
    $('#competitorsBtn')?.addEventListener('click', async () => {
      const keyword = $('#competitorKeyword')?.value.trim();
      if(!keyword) return alert('Enter a keyword');
      const out = $('#competitorsOut'); out.textContent = 'Analyzing‚Ä¶';
      try{
        const d = await postTool('/api/tools/competitor-analysis', { keyword });
        const parts = [];
        if(d.difficulty) parts.push('Difficulty: ' + d.difficulty);
        if(d.recommendations?.target_word_count) parts.push('Target word count: ' + d.recommendations.target_word_count);
        out.innerHTML = parts.join(' ‚Ä¢ ') || 'Done';
      }catch(e){ out.textContent = e.message || 'Failed'; }
    });

    // Keywords
    $('#keywordsBtn')?.addEventListener('click', async () => {
      const topic = $('#keywordsTopic')?.value.trim();
      const text = $('#keywordsText')?.value.trim();
      if(!topic) return alert('Enter a topic');
      const out = $('#keywordsOut'); out.textContent = 'Clustering‚Ä¶';
      try{
        const d = await postTool('/api/tools/keywords', { topic, text });
        out.innerHTML = ['primary','secondary','long_tail','questions'].map(k => `
          <div class="mb-2">
            <div class="text-indigo-300 font-bold uppercase text-xs mb-1">${k.replace('_',' ')}</div>
            <div class="flex flex-wrap">${(d[k]||[]).map(x => `<span class="pill">${esc(x)}</span>`).join('')}</div>
          </div>
        `).join('');
      }catch(e){ out.textContent = e.message || 'Failed'; }
    });

    // Brief
    $('#briefBtn')?.addEventListener('click', async () => {
      const keyword = $('#briefKeyword')?.value.trim();
      if(!keyword) return alert('Enter a keyword');
      const out = $('#briefOut'); out.textContent = 'Generating‚Ä¶';
      try{
        const d = await postTool('/api/tools/content-brief', { keyword });
        out.innerHTML = `
          <div class="grid md:grid-cols-3 gap-3 mb-2">
            <div class="glass p-3 rounded-lg"><div class="text-xs text-indigo-300 font-bold uppercase">Keyword</div><div class="font-extrabold">${esc(d.keyword||keyword)}</div></div>
            <div class="glass p-3 rounded-lg"><div class="text-xs text-indigo-300 font-bold uppercase">Intent</div><div class="font-extrabold">${esc(d.search_intent||'')}</div></div>
            <div class="glass p-3 rounded-lg"><div class="text-xs text-indigo-300 font-bold uppercase">Target</div><div class="font-extrabold">${esc(d.target_word_count||'')}</div></div>
          </div>
        `;
      }catch(e){ out.textContent = e.message || 'Failed'; }
    });

    // Meta
    $('#metaBtn')?.addEventListener('click', async () => {
      const content = $('#metaContent')?.value.trim();
      if(!content) return alert('Paste content');
      const out = $('#metaOut'); out.textContent = 'Summarizing‚Ä¶';
      try{
        const d = await postTool('/api/tools/meta-description', { content });
        out.innerHTML = `<strong>Description:</strong> ${esc(d.description || '')}`;
      }catch(e){ out.textContent = e.message || 'Failed'; }
    });

    // Assistant
    $('#assistantBtn')?.addEventListener('click', async () => {
      const prompt = $('#assistantPrompt')?.value.trim();
      const context = $('#assistantContext')?.value.trim();
      if(!prompt) return alert('Enter a prompt');
      const out = $('#assistantOut'); out.textContent = 'Thinking‚Ä¶';
      try{
        const d = await postTool('/api/ai-assistant', { prompt, context });
        out.innerHTML = (d.suggestions?.length)
          ? '<ul class="list-disc ml-5 text-white/80">' + d.suggestions.map(s => `<li>${esc(s)}</li>`).join('') + '</ul>'
          : 'Done';
      }catch(e){ out.textContent = e.message || 'Failed'; }
    });

    // AUTH
    function openAuth(){ document.getElementById('authModal').style.display='block'; try{ window.lucide && lucide.createIcons(); }catch{} }
    function closeAuth(){ document.getElementById('authModal').style.display='none'; }
    function openPrivacy(){ document.getElementById('privacyModal').style.display='block'; }
    function closePrivacy(){ document.getElementById('privacyModal').style.display='none'; }
    function openTerms(){ document.getElementById('termsModal').style.display='block'; }
    function closeTerms(){ document.getElementById('termsModal').style.display='none'; }

    document.addEventListener('click', (e) => {
      const el = e.target.closest('[data-action]'); if(!el) return;
      const act = el.dataset.action;
      if(act==='open-auth') openAuth();
      if(act==='close-auth') closeAuth();
      if(act==='open-privacy') openPrivacy();
      if(act==='close-privacy') closePrivacy();
      if(act==='open-terms') openTerms();
      if(act==='close-terms') closeTerms();
      if(act==='scroll-hero') document.getElementById('heroTopic')?.scrollIntoView({ behavior:'smooth' });
      if(act==='google-auth'){
        const redirectBack = window.location.origin;
        window.location.href = API + '/auth/google?redirect=' + encodeURIComponent(redirectBack);
      }
    });

    // Magic link
    $('#magicForm')?.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = $('#authEmail')?.value.trim();
      if(!email) return alert('Enter your email');
      try{
        const r = await fetch(API + '/auth/magic-link', {
          method:'POST', headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ email, redirect: window.location.origin }), mode:'cors'
        });
        if(!r.ok) throw new Error('Failed to send magic link');
        alert('Magic link sent!'); closeAuth();
      }catch(err){ alert(err?.message || 'Failed'); }
    });

    // Handle OAuth callback
    (function parseOAuth(){
      const q = new URLSearchParams(location.search);
      const h = new URLSearchParams((location.hash||'').replace(/^#/,''));
      const get = (k)=> q.get(k) || h.get(k);
      const access = get('access_token');
      const refresh = get('refresh_token');
      const error = get('error');
      if(access){ localStorage.setItem('authToken', access); state.authToken = access; }
      if(refresh){ localStorage.setItem('refreshToken', refresh); }
      if(access || refresh){ alert('Signed in ‚úÖ'); history.replaceState({},'',location.origin + location.pathname); fetchProfile(); }
      if(error){ alert('Auth error: ' + error); history.replaceState({},'',location.origin + location.pathname); }
    })();

    // Enhance icons
    try{ window.lucide && lucide.createIcons(); }catch{}
  })();
  </script>
</body>
</html>
